;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;True LevelASM Code lies ahead.
;If you are too lazy to search for a level
;Use CTRL+F. The format is as following:
;levelx - Levels 0-F
;levelxx - Levels 10-FF
;levelxxx - Levels 100-1FF
;Should be pretty obvious...
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 
 incsrc ../../Patches/Defines.asm
 incsrc ../../Patches/Subroutines.asm
 incsrc ../../Patches/Macros.asm
 table ../../Patches/PokemonFont.txt
 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

level0:
	RTS
level1:
	RTS
level2:
	RTS
level3:
	RTS
level4:
	RTS
level5:
	RTS
level6:
	RTS
level7:
	RTS
level8:
	RTS
level9:
	RTS
levelA:
	RTS
levelB:
	RTS
levelC:
	RTS
levelD:
	RTS
levelE:
	RTS
levelF:
	RTS
level10:
	RTS
level11:
	RTS
level12:
	RTS
level13:
	RTS
level14:
	RTS
level15:
	RTS
level16:
	RTS
level17:
	RTS
level18:
	RTS
level19:
	RTS
level1A:
	RTS
level1B:
	RTS
level1C:
	RTS
level1D:
	RTS
level1E:
	RTS
level1F:
	RTS
level20:
	RTS
level21:
	RTS
level22:
	RTS
level23:
	RTS
level24:
	RTS
level25:
	RTS
level26:
	RTS
level27:
	RTS
level28:
	RTS
level29:
	RTS
level2A:
	RTS
level2B:
	RTS
level2C:
	RTS
level2D:
	RTS
level2E:
	RTS
level2F:
	RTS
level30:
	RTS
level31:
	RTS
level32:
	RTS
level33:
	RTS
level34:
	RTS
level35:
	RTS
level36:
	RTS
level37:
	RTS
level38:
	RTS
level39:
	RTS
level3A:
	RTS
level3B:
	RTS
level3C:
	RTS
level3D:
	RTS
level3E:
	RTS
level3F:
	RTS
level40:
	RTS
level41:
	RTS
level42:
	RTS
level43:
	RTS
level44:
	RTS
level45:
	RTS
level46:
	RTS
level47:
	RTS
level48:
	RTS
level49:
	RTS
level4A:
	RTS
level4B:
	RTS
level4C:
	RTS
level4D:
	RTS
level4E:
	RTS
level4F:
	RTS
level50:
	RTS
level51:
	RTS
level52:
	RTS
level53:
	RTS
level54:
	RTS
level55:
	RTS
level56:
	RTS
level57:
	RTS
level58:
	RTS
level59:
	RTS
level5A:
	RTS
level5B:
	RTS
level5C:
	RTS
level5D:
	RTS
level5E:
	RTS
level5F:
	RTS
level60:
	RTS
level61:
	RTS
level62:
	RTS
level63:
	RTS
level64:
	RTS
level65:
	RTS
level66:
	RTS
level67:
	RTS
level68:
	RTS
level69:
	RTS
level6A:
	RTS
level6B:
	RTS
level6C:
	RTS
level6D:
	RTS
level6E:
	RTS
level6F:
	RTS
level70:
	RTS
level71:
	RTS
level72:
	RTS
level73:
	RTS
level74:
	RTS
level75:
	RTS
level76:
	RTS
level77:
	RTS
level78:
	RTS
level79:
	RTS
level7A:
	RTS
level7B:
	RTS
level7C:
	RTS
level7D:
	RTS
level7E:
	RTS
level7F:
	RTS
level80:
	RTS
level81:
	RTS
level82:
	RTS
level83:
	RTS
level84:
	RTS
level85:
	RTS
level86:
	RTS
level87:
	RTS
level88:
	RTS
level89:
	RTS
level8A:
	RTS
level8B:
	RTS
level8C:
	RTS
level8D:
	RTS
level8E:
	RTS
level8F:
	RTS
level90:
	RTS
level91:
	RTS
level92:
	RTS
level93:
	RTS
level94:
	RTS
level95:
	RTS
level96:
	RTS
level97:
	RTS
level98:
	RTS
level99:
	RTS
level9A:
	RTS
level9B:
	RTS
level9C:
	RTS
level9D:
	RTS
level9E:
	RTS
level9F:
	RTS
levelA0:
	RTS
levelA1:
	RTS
levelA2:
	RTS
levelA3:
	RTS
levelA4:
	RTS
levelA5:
	RTS
levelA6:
	RTS
levelA7:
	RTS
levelA8:
	RTS
levelA9:
	RTS
levelAA:
	RTS
levelAB:
	RTS
levelAC:
	RTS
levelAD:
	RTS
levelAE:
	RTS
levelAF:
	RTS
levelB0:
	RTS
levelB1:
	RTS
levelB2:
	RTS
levelB3:
	RTS
levelB4:
	RTS
levelB5:
	RTS
levelB6:
	RTS
levelB7:
	RTS
levelB8:
	RTS
levelB9:
	RTS
levelBA:
	RTS
levelBB:
	RTS
levelBC:
	RTS
levelBD:
	RTS
levelBE:
	RTS
levelBF:
	RTS
levelC0:
	RTS
levelC1:
	RTS
levelC2:
	RTS
levelC3:
	RTS
levelC4:
	RTS
levelC5:
	RTS
levelC6:
	RTS
levelC7:
	RTS
levelC8:
	RTS
levelC9:
	RTS
levelCA:
	RTS
levelCB:
	RTS
levelCC:
	RTS
levelCD:
	RTS
levelCE:
	RTS
levelCF:
	RTS
levelD0:
	RTS
levelD1:
	RTS
levelD2:
	RTS
levelD3:
	RTS
levelD4:
	RTS
levelD5:
	RTS
levelD6:
	RTS
levelD7:
	RTS
levelD8:
	RTS
levelD9:
	RTS
levelDA:
	RTS
levelDB:
	RTS
levelDC:
	RTS
levelDD:
	RTS
levelDE:
	RTS
levelDF:
	RTS
levelE0:
	RTS
levelE1:
	RTS
levelE2:
	RTS
levelE3:
	RTS
levelE4:
	RTS
levelE5:
	RTS
levelE6:
	RTS
levelE7:
	RTS
levelE8:
	RTS
levelE9:
	RTS
levelEA:
	RTS
levelEB:
	RTS
levelEC:
	RTS
levelED:
	RTS
levelEE:
	RTS
levelEF:
	RTS
levelF0:
	RTS
levelF1:
	RTS
levelF2:
	RTS
levelF3:
	RTS
levelF4:
	RTS
levelF5:
	RTS
levelF6:
	RTS
levelF7:
	RTS
levelF8:
	RTS
levelF9:
	RTS
levelFA:
	RTS
levelFB:
	RTS
levelFC:
	RTS
levelFD:
	RTS
levelFE:
	RTS
levelFF:
	RTS
level100:
	RTS
level101:
	RTS
level102:
	RTS
level103:
	RTS
level104:
	RTS
level105:
	PEA.w GlobalRt-1
MainRt:
	LDA !BattleState
	JSL $0086DF
	
	dw Overworld
	dw PlayerWin
	dw FadeIn
	dw UploadSprites
	dw EnemyStats
	dw DispWildPoke
	dw ThrowPoke
	dw DisplayStats
	dw UploadTextBox
	dw MessageInit
	dw Message
	dw UploadBattleBox
	dw BattleSelect
	dw AttackSelect
	dw DisplayAttack
	dw DecreaseHP
	dw PokeSelect
	dw ItemSelect
	dw Run
	
GlobalRt:
	LDA !BattleState : BEQ +
	; Move layer 1 so that it fills the screen.
	STZ $210D : STZ $210D
	STZ $210E : STZ $210E
	
	LDA #$04 : STA $212C
	LDA #$1B : STA $212D
	STZ $2111 : STZ $2111
	STZ $2112 : STZ $2112
	REP #$20
	STZ $22 : STZ $24
	SEP #$20
	; Disable movement.
	STZ $7B : STZ $7D
	; Hide the player.
	LDA #$FF : STA $78
	
;	LDX #$36
;-	LDA #$80 : STA $0EF9,x
;	DEX : BPL -
+	RTS
	
Overworld:
	; Enable free vertical scrolling.
	LDA #$01 : STA $1404
	; Allow free movement without interference from physics engine.
	STZ $7B : STZ $7D
	; Increase timer.
	INC !Timer
	
	LDA #$08 : STA $0250
	LDA #$08 : STA $0251
	LDA $1A : LSR #4 : STA $0252
	LDA #$33 : STA $0253
	STZ $0434
	
	LDA #$10 : STA $0254
	LDA #$08 : STA $0255
	LDA $1A : AND #$0F : STA $0256
	LDA #$33 : STA $0257
	STZ $0435
	
	LDA #$20 : STA $0258
	LDA #$08 : STA $0259
	LDA $1B : LSR #4 : STA $025A
	LDA #$33 : STA $025B
	STZ $0436
	
	LDA #$28 : STA $025C
	LDA #$08 : STA $025D
	LDA $1B : AND #$0F : STA $025E
	LDA #$33 : STA $025F
	STZ $0437
	
Motion:
	LDA $13D4 : BNE .Return
	
	LDA !Direction : BEQ .Press
	STZ !EncounterFlag
	CMP #$01 : BNE + : JMP .KeepRight
+	CMP #$02 : BNE + : JMP .KeepLeft
+	CMP #$03 : BNE + : JMP .KeepDown
+	CMP #$04 : BNE + : JMP .KeepUp
+	
.Press
	LDA $15 : AND #$0F : BEQ .Return
	CMP #$01 : BNE + : JMP .Right
+	CMP #$02 : BNE + : JMP .Left
+	CMP #$04 : BNE + : JMP .Down
+	CMP #$08 : BNE + : JMP .Up
+	BRA .Return
.ClearDirection
	STZ !Direction
.Return
	LDX !LastDirection
	LDA .Pose,x : STA $13E0
	RTS
	
	.Pose
		db !PoseRight1,!PoseLeft1,!PoseDown1,!PoseUp1
	.MoveX
		dw $0000,$0000,$FFF0,$0010
	.MoveY
		dw $FFF0,$0010,$0000,$0000
	
.Right
	LDX #!PoseRight1 : LDY #!PoseRight2 : LDA #!PoseRight3 : JSR Animation
	; Remember that we're moving and which direction we're facing.
	LDA #$01 : STA !Direction : DEC : STA !LastDirection
	
	REP #$20 : INC $94 : SEP #$20
	STZ !EncounterFlag
	RTS
.KeepRight
	LDA #$FE : TRB $15
	LDA $77 : BIT #$01 : BEQ + : JMP .ClearDirection

	; If Mario's position next frame is divisible by 0x10, we've moved one whole tile.
+	LDA $D1 : INC : AND #$0F : BNE +
	STZ !Direction
	
+	REP #$20 : INC $94 : SEP #$20
	LDX #!PoseRight1 : LDY #!PoseRight2 : LDA #!PoseRight3 : JSR Animation
	RTS
.Left
	LDX #!PoseLeft1 : LDY #!PoseLeft2 : LDA #!PoseLeft3 : JSR Animation
	LDA #$02 : STA !Direction : DEC : STA !LastDirection
	
	REP #$20 : DEC $94 : SEP #$20
	STZ !EncounterFlag
	RTS
.KeepLeft
	LDA #$FD : TRB $15
	LDA $77 : BIT #$02 : BEQ + : JMP .ClearDirection
	
+	LDA $D1 : DEC : AND #$0F : BNE +
	STZ !Direction
	
+	REP #$20 : DEC $94 : SEP #$20
	LDX #!PoseLeft1 : LDY #!PoseLeft2 : LDA #!PoseLeft3 : JSR Animation
	RTS
.Down
	LDX #!PoseDown1 : LDY #!PoseDown2 : LDA #!PoseDown3 : JSR Animation
	LDA #$03 : STA !Direction : DEC : STA !LastDirection
	
	REP #$20 : INC $96 : SEP #$20
	STZ !EncounterFlag
	RTS
.KeepDown
	LDA #$FB : TRB $15
	LDA $77 : BIT #$04 : BEQ + : JMP .ClearDirection
	
+	LDA $D3 : INC : AND #$0F : BNE +
	STZ !Direction
	
+	REP #$20 : INC $96 : SEP #$20
	LDX #!PoseDown1 : LDY #!PoseDown2 : LDA #!PoseDown3 : JSR Animation
	RTS
.Up
	LDX #!PoseUp1 : LDY #!PoseUp2 : LDA #!PoseUp3 : JSR Animation
	LDA #$04 : STA !Direction : DEC : STA !LastDirection
	
	REP #$20 : DEC $96 : SEP #$20
	STZ !EncounterFlag
	RTS
.KeepUp
	LDA #$F7 : TRB $15
	LDA $77 : BIT #$08 : BEQ + : JMP .ClearDirection
	
+	LDA $D3 : DEC : AND #$0F : BNE +
	STZ !Direction
	
+	REP #$20 : DEC $96 : SEP #$20
	LDX #!PoseUp1 : LDY #!PoseUp2 : LDA #!PoseUp3 : JSR Animation
	RTS
	
Animation:
	; This confuses me sometimes. Flows like this:
	; Frame 2 = !Timer < #$08
	; Frame 1 = #$08 <= !Timer < #$10
	; Frame 3 = #$10 <= !Timer < #$18
	; Frame 1 = #$18 <= !Timer < #$20
	PHA
	LDA !Timer
	CMP #$08 : BCC .Frame2
	CMP #$10 : BCC .Frame1
	CMP #$18 : BCC .Frame3
	CMP #$20 : BCS .Reset
.Frame1
	PLA
	STX $13E0
	RTS
.Frame2
	PLA
	STY $13E0
	RTS
.Frame3
	PLA
	STA $13E0
	RTS
.Reset
	PLA
	STZ !Timer
	BRA Animation
	
Battle:
PlayerWin:
	RTS
	
FadeIn:
	REP #$20
	LDX #$01 : STX !PaletteFlag
	LDA #$7FFF
	STA $070D : STA $070F : STA $0711
	SEP #$20
	STZ !RunAttempts
	INC !BattleState
	RTS
	
UploadSprites:
.UploadEnemySprite
	; This routine only uploads the graphics of the enemy Pokemon to GFX2A.
	; The actual tiles are displayed later.
	; Offset 0x0A contains the dimensions of the sprite. The first nybble is width. The second is height.
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$000A : TAX
	SEP #$20
	LDA BaseStats,x : LSR #4 : STA $00
	LDA BaseStats,x : AND #$0F : STA $02
	SEP #$10
	; Multiply them together to get the number of tiles to upload.
	LDA #$00
	JSR Multiply
	TAY
	; Start DMA.
	LDA #$03 : STA !DMAFlag
	REP #$20
	; Multiply the number of tiles by #$10 to get the number of bytes.
	TYA : ASL #4 : STA $03
	
	REP #$10
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$000B : TAX
	LDA #FrontSprite : CLC : ADC BaseStats,x : STA $00
	SEP #$10
	LDY.b #FrontSprite>>16 : STY $02
	
	LDA #$4800 : STA !Dest1
	LDA $00 : STA !Tilemap1
	LDY.b $02 : STY !Tilemap1+2
	LDA $03 : DEC : STA !Size1
	
.UploadPartySprite
	REP #$10
	LDA !Poke1 : AND #$00FF : DEC : ASL #5 : CLC : ADC #$000D : TAX
	LDA #$4C00 : STA !Dest2
	LDA #BackSprite : CLC : ADC BaseStats,x : STA !Tilemap2
	SEP #$10
	LDY.b #BackSprite>>16 : STY !Tilemap2+2
	LDA #$030F : STA !Size2
	SEP #$20
	INC !BattleState
	RTS
	
EnemyStats:
	; Determine IVs.
	; IV format: 2 bytes, aaaadddd sssspppp
	; a = Attack, d = Defense, s = Speed, p = Special
	; HP IV is calculated by taking the last bit from Attack, Defense, Speed, and Special and placing them in that order.
	LDA #$FF
	JSR Random
	STA !EnemyIVs
	
	LDA #$FF
	JSR Random
	STA !EnemyIVs+1

.CalculateAttack
	; Formula: ([(IV + Base) * Level]/50) + 5
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0002 : TAX
	SEP #$20
	LDA !EnemyIVs : LSR #4 : CLC : ADC BaseStats,x : STA $4202
	SEP #$10
	LDA !EnemyLevel : STA $4203
	JSR Cycles
	REP #$20
	LDA $4216 : STA $4204
	LDX #$32 : STX $4206
	JSR Cycles
	LDA $4214 : CLC : ADC #$0005 : STA !EnemyAttack
	SEP #$20
.CalculateDefense
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0003 : TAX
	SEP #$20
	LDA !EnemyIVs : AND #$0F : CLC : ADC BaseStats,x : STA $4202
	SEP #$10
	LDA !EnemyLevel : STA $4203
	JSR Cycles
	REP #$20
	LDA $4216 : STA $4204
	LDX #$32 : STX $4206
	JSR Cycles
	LDA $4214 : CLC : ADC #$0005 : STA !EnemyDefense
	SEP #$20
.CalculateSpeed
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0004 : TAX
	SEP #$20
	LDA !EnemyIVs+1 : LSR #4 : CLC : ADC BaseStats,x : STA $4202
	SEP #$10
	LDA !EnemyLevel : STA $4203
	JSR Cycles
	REP #$20
	LDA $4216 : STA $4204
	LDX #$32 : STX $4206
	JSR Cycles
	LDA $4214 : CLC : ADC #$0005 : STA !EnemySpeed
	SEP #$20
.CalculateSpecial
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0005 : TAX
	SEP #$20
	LDA !EnemyIVs+1 : AND #$0F : CLC : ADC BaseStats,x : STA $4202
	SEP #$10
	LDA !EnemyLevel : STA $4203
	JSR Cycles
	REP #$20
	LDA $4216 : STA $4204
	LDX #$32 : STX $4206
	JSR Cycles
	LDA $4214 : CLC : ADC #$0005 : STA !EnemySpecial
	SEP #$20
.CalculateHP
	; Formula: ([(IV + Base + 50) * Level]/50) + 10
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0001 : TAX
	SEP #$20
	LDA !EnemyIVs : AND #$10 : LSR : STA $00
	LDA !EnemyIVs : AND #$01 : ASL #2 : ORA $00 : STA $00
	LDA !EnemyIVs+1 : AND #$10 : LSR #3 : ORA $00 : STA $00
	LDA !EnemyIVs+1 : AND #$01 : ORA $00 : STA $00
	LDA $00 : CLC : ADC BaseStats,x : ADC #$32 : STA $4202
	SEP #$10
	LDA !EnemyLevel : STA $4203
	JSR Cycles
	REP #$20
	LDA $4216 : STA $4204
	LDX #$32 : STX $4206
	JSR Cycles
	LDA $4214 : CLC : ADC #$000A : STA !EnemyMaxHP : STA !EnemyHP
	SEP #$20
.SetName
	LDX #$13
-	LDA #$80 : STA !EnemyName,x
	DEX : BPL -
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL : TAY
	LDA PokeNamesTable,y : STA $04
	SEP #$20
	LDX #$0000
-	LDA ($04) : STA !EnemyName,x : INX
	CMP #$FF : BEQ .SetMoves
	REP #$20 : INC $04 : SEP #$20
	BRA -
.SetMoves
	LDA #$00
	STA !NumberMoves
	STA !EnemyMove1 : STA !EnemyMove2
	STA !EnemyMove3 : STA !EnemyMove4
	REP #$30
	; Keep this so we know where the start of the learnset is.
	LDA !Enemy : AND #$00FF : DEC : ASL : TAX
	LDA LearnsetTable,x : STA $00 : INC : STA $02
	SEP #$20
	LDX #$0000
-	LDA ($00) : BEQ .MoveCheckingDone
	LDA !EnemyLevel : CMP ($00) : BCC +
	LDA !NumberMoves : INC : STA !NumberMoves
+	LDY $00 : INY #2 : STY $00
	BRA -
.MoveCheckingDone
	SEP #$10
	LDA !NumberMoves
	CMP #$05 : BCS .GT4
.LT4
	LDX #$00
	LDA !NumberMoves : BEQ .MiscStats : DEC : TAY
-	LDA ($02) : STA !EnemyMove1,x
	REP #$20 : LDA $02 : INC #2 : STA $02 : SEP #$20
	INX
	DEY : BPL -
	BRA .WritePP
	
.GT4
	; If more than 4 moves, start at the 4th from the last
	LDX #$00
	LDA !NumberMoves : SEC : SBC #$05 : TAY
-	REP #$20 : LDA $02 : INC #2 : STA $02 : SEP #$20
	DEY : BPL -
	LDY #$03
-	LDA ($02) : STA !EnemyMove1,x
	INX
	REP #$20 : LDA $02 : INC #2 : STA $02 : SEP #$20
	DEY : BPL -
	
.WritePP
	REP #$10
	LDX #$0003
-	REP #$20
	LDA !EnemyMove1,x : AND #$00FF : DEC : ASL #3 : CLC : ADC #$0005 : TAY
	SEP #$20
	LDA Attack,y : STA !EnemyMove1PP,x
	DEX : BPL -
	SEP #$30
	
.MiscStats
	; Set status.
	LDA #$00 : STA !EnemyStatus
	; Set types.
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0006 : TAX
	LDA BaseStats,x : STA !EnemyType1
	SEP #$20
	; Set catch rate.
	INX : INX
	LDA BaseStats,x : STA !EnemyCatchRate
	SEP #$10
	INC !BattleState
	RTS
	
DispWildPoke:
	; Offset 0x0A contains the dimensions of the sprite.
	REP #$30
	LDA !Enemy : AND #$00FF : DEC : ASL #5 : CLC : ADC #$000A : TAX
	; Get the width and use it to determine how many bytes to upload per row.
	SEP #$20
	LDA BaseStats,x : LSR #4 : ASL : STA $03
	; Get the height and use it to determine how many rows to upload.
	LDA BaseStats,x : AND #$0F : DEC : STA $04
	SEP #$10
	; Offset 0x0B (2 bytes) points to the tilemap for each Pokemon.
	REP #$20
	LDA #SpriteTilemap : STA $00
	LDY.b #SpriteTilemap>>16 : STY $02
	
	LDX $04
	LDY .DMAFlag,x : STY !DMAFlag
	
	%DrawPokemon(1,$50B8)
	DEX : BPL + : JMP .UploadFinished
	
+	CLC : ADC $00 : STA $00
	%DrawPokemon(2,$50D8)
	DEX : BPL + : JMP .UploadFinished
	
+	CLC : ADC $00 : STA $00
	%DrawPokemon(3,$50F8)
	DEX : BPL + : JMP .UploadFinished
	
+	CLC : ADC $00 : STA $00
	%DrawPokemon(4,$5118)
	DEX : BPL + : JMP .UploadFinished
	
+	CLC : ADC $00 : STA $00
	%DrawPokemon(5,$5138)
	DEX : BPL + : JMP .UploadFinished
	
+	CLC : ADC $00 : STA $00
	%DrawPokemon(6,$5158)
	DEX : BPL + : JMP .UploadFinished
	
+	CLC : ADC $00 : STA $00
	%DrawPokemon(7,$5178)
.UploadFinished
	SEP #$20
	INC !BattleState
	RTS
	
	.DMAFlag
		db $01,$03,$07,$0F,$1F,$3F,$7F,$FF
	
ThrowPoke:
	; Upload 7 tiles, two bytes each, per row.
	LDA #$0E : STA $03
	REP #$20
	LDA #BackSpriteTilemap : STA $00
	LDY.b #BackSpriteTilemap>>16 : STY $02
	
	LDY #$7F : STY !DMAFlag
	
	%DrawPokemon(1,$5162)
	CLC : ADC $00 : STA $00
	%DrawPokemon(2,$5182)
	CLC : ADC $00 : STA $00
	%DrawPokemon(3,$51A2)
	CLC : ADC $00 : STA $00
	%DrawPokemon(4,$51C2)
	CLC : ADC $00 : STA $00
	%DrawPokemon(5,$51E2)
	CLC : ADC $00 : STA $00
	%DrawPokemon(6,$5202)
	CLC : ADC $00 : STA $00
	%DrawPokemon(7,$5222)
	SEP #$20
	INC !BattleState
	RTS
	
DisplayStats:
	JSR UpdatePlayerHUD
	JSR UpdateEnemyHUD
	INC !BattleState
	RTS

UpdatePlayerHUD:
Box1Line1:
	LDX #$00 : LDY #$00
	; Write name
	PHB
	LDA #$70 : PHA : PLB
-	LDA !Poke1NameShort,y : STA !Box1Line1,x : INX : INY
	LDA #$20 : STA !Box1Line1,x : INX
	CPX #$14 : BCC -
	PLB
	; Write level
	REP #$20
	LDA #$208E : STA !Box1Line1,x : INX #2
	SEP #$20
	LDA !Poke1Level : STA $00
	STZ $01
	JSR HexDec
.Eq100
	LDA $01 : BEQ .LT100
	CLC : ADC #$E6 : STA !Box1Line1,x : INX
	LDA #$20 : STA !Box1Line1,x : INX
.LT100
	LDA $01 : BNE +
	LDA $02 : BEQ .LT10
+	LDA $02 : CLC : ADC #$E6 : STA !Box1Line1,x : INX
	LDA #$20 : STA !Box1Line1,x : INX
.LT10
	LDA $03 : CLC : ADC #$E6 : STA !Box1Line1,x : INX
	LDA #$20 : STA !Box1Line1,x : INX
	; Fill in the rest
	REP #$20
-	CPX #$1C : BEQ +
	LDA #$2080 : STA !Box1Line1,x : INX #2
	BRA -
+	LDA #$208A : STA !Box1Line1,x : INX #2

	LDA #$0001 : TSB !DMAFlag
	LDA #$51D0 : STA !Dest1
	TXA : STA !Size1
	LDA #!Box1Line1 : STA !Tilemap1
	LDY.b #!Box1Line1>>16 : STY !Tilemap1+2
	
Box1Line2:
	LDX #$00
	; Write "HP"
	LDA #$208B : STA !Box1Line2,x : INX #2
	INC : STA !Box1Line2,x : INX #2
	; Multiply current HP by 64.
	; TODO: Scale by 4 if max HP > 255
	LDA !Poke1HP : ASL #6 : STA $4204
	LDA !Poke1MaxHP : TAY : STY $4206
	JSR Cycles
	; Divide the quotient by 8 for counting tiles.
	LDA $4214 : STA $4204
	LDY #$08 : STY $4206
	JSR Cycles
	
.Quotient
	LDA $4214 : BEQ .Remainder : DEC : TAY
-	LDA #$20F8 : STA !Box1Line2,x : INX #2
	DEY : BPL -
	
.Remainder
	SEP #$20
	LDA $4216 : BEQ .Empty : CLC : ADC #$F0 : STA !Box1Line2,x : INX
	LDA #$20 : STA !Box1Line2,x : INX
	
.Empty
	REP #$20
-	CPX #$14 : BEQ +
	LDA #$20F0 : STA !Box1Line2,x : INX #2
	BRA -
+	LDA #$208D : STA !Box1Line2,x : INX #2	
		
	LDA #$0002 : TSB !DMAFlag
	LDA #$51F4 : STA !Dest2
	TXA : STA !Size2
	LDA #!Box1Line2 : STA !Tilemap2
	LDY.b #!Box1Line2>>16 : STY !Tilemap2+2
	
Box1Line3:
	LDX #$00
	; Current HP
	LDA !Poke1HP : STA $00
	SEP #$20
	JSR HPCount
	; /
	REP #$20
	LDA #$20E3 : STA !Box1Line3,x : INX #2
	; Max HP
	LDA !Poke1MaxHP : STA $00
	SEP #$20
	JSR HPCount
	REP #$20
	LDA #$208A : STA !Box1Line3,x : INX #2
	
	LDA #$0004 : TSB !DMAFlag
	LDA #$5217 : STA !Dest3
	TXA : STA !Size3
	LDA #!Box1Line3 : STA !Tilemap3
	LDY.b #!Box1Line3>>16 : STY !Tilemap3+2
	
Box1Line4:
	LDX #$00
	LDA #$2087 : STA !Box1Line4,x : INX #2
	LDY #$0D
	INC
-	STA !Box1Line4,x : INX #2
	DEY : BPL -
	INC : STA !Box1Line4,x : INX #2
	
	LDA #$0008 : TSB !DMAFlag
	LDA #$522F : STA !Dest4
	TXA : STA !Size4
	LDA #!Box1Line4 : STA !Tilemap4
	LDY.b #!Box1Line4>>16 : STY !Tilemap4+2
	SEP #$20
	RTS
	
HPCount:
	JSR HexDec

	LDA $01 : BNE .GT100
	REP #$20
	LDA #$2080 : STA !Box1Line3,x
	SEP #$20
	BRA .LT100
.GT100
	CLC : ADC #$E6 : XBA
	LDA #$20 : XBA
	REP #$20
	STA !Box1Line3,x
	SEP #$20
.LT100
	INX #2
	LDA $01 : BNE +
	LDA $02 : BNE +
	REP #$20
	LDA #$2080 : STA !Box1Line3,x
	SEP #$20
	BRA .LT10
+	LDA $02 : CLC : ADC #$E6 : XBA
	LDA #$20 : XBA
	REP #$20
	STA !Box1Line3,x
	SEP #$20
.LT10
	INX #2
	LDA $03 : CLC : ADC #$E6 : STA !Box1Line3,x : INX
	LDA #$20 : STA !Box1Line3,x : INX
	RTS
	
UpdateEnemyHUD:
Box2Line1:
	REP #$20
	LDX #$00 : LDY #$00
	LDA #$208A : STA !Box2Line1,x : INX #2
	SEP #$20
	; Write name
	PHB
	LDA #$7F : PHA : PLB
-	LDA !EnemyNameShort,y : STA !Box2Line1,x : INX : INY
	LDA #$20 : STA !Box2Line1,x : INX
	CPX #$16 : BCC -
	PLB
	; Write level
	REP #$20
	LDA #$208E : STA !Box2Line1,x : INX #2
	SEP #$20
	LDA !EnemyLevel : STA $00
	STZ $01
	JSR HexDec
.Eq100
	LDA $01 : BEQ .LT100
	CLC : ADC #$E6 : STA !Box2Line1,x : INX
	LDA #$20 : STA !Box2Line1,x : INX
.LT100
	LDA $01 : BNE +
	LDA $02 : BEQ .LT10
+	LDA $02 : CLC : ADC #$E6 : STA !Box2Line1,x : INX
	LDA #$20 : STA !Box2Line1,x : INX
.LT10
	LDA $03 : CLC : ADC #$E6 : STA !Box2Line1,x : INX
	LDA #$20 : STA !Box2Line1,x : INX
	; Fill in the rest
	REP #$20
-	CPX #$1E : BEQ +
	LDA #$2080 : STA !Box2Line1,x : INX #2
	BRA -
	
+	LDA #$0010 : TSB !DMAFlag
	LDA #$5061 : STA !Dest5
	TXA : STA !Size5
	LDA #!Box2Line1 : STA !Tilemap5
	LDY.b #!Box2Line1>>16 : STY !Tilemap5+2

Box2Line2:
	LDX #$00
	LDA #$208A : STA !Box2Line2,x : INX #2
	; Write "HP"
	INC : STA !Box2Line2,x : INX #2
	INC : STA !Box2Line2,x : INX #2
	; Multiply current HP by 64.
	; TODO: Scale by 4 if max HP > 255
	LDA !EnemyHP : ASL #6 : STA $4204
	LDA !EnemyMaxHP : TAY : STY $4206
	JSR Cycles
	; Divide the quotient by 8 for counting tiles.
	LDA $4214 : STA $4204
	LDY #$08 : STY $4206
	JSR Cycles
	
.Quotient
	LDA $4214 : BEQ .Remainder : DEC : TAY
-	LDA #$20F8 : STA !Box2Line2,x : INX #2
	DEY : BPL -
	
.Remainder
	SEP #$20
	LDA $4216 : BEQ .Empty : CLC : ADC #$F0 : STA !Box2Line2,x : INX
	LDA #$20 : STA !Box2Line2,x : INX
	
.Empty
	REP #$20
-	CPX #$16 : BEQ +
	LDA #$20F0 : STA !Box2Line2,x : INX #2
	BRA -
+	LDA #$208F : STA !Box2Line2,x : INX #2	
		
	LDA #$0020 : TSB !DMAFlag
	LDA #$5081 : STA !Dest6
	TXA : STA !Size6
	LDA #!Box2Line2 : STA !Tilemap6
	LDY.b #!Box2Line2>>16 : STY !Tilemap6+2

Box2Line3:
	LDX #$00
	LDA #$6089 : STA !Box2Line3,x : INX #2
	LDY #$0D
	DEC
-	STA !Box2Line3,x : INX #2
	DEY : BPL -
	DEC : STA !Box2Line3,x : INX #2
	
	LDA #$0040 : TSB !DMAFlag
	LDA #$50A1 : STA !Dest7
	TXA : STA !Size7
	LDA #!Box2Line3 : STA !Tilemap7
	LDY.b #!Box2Line3>>16 : STY !Tilemap7+2
	SEP #$20
	RTS
	
UploadTextBox:
	JSR WriteText_ClearText
	INC !BattleState
	RTS
	
MessageInit:
	LDX #$00 : LDY #$00
	%StoreMessage(WildPoke)
	%WriteMessage()
	INC !BattleState
Message:
	JSR WriteText
	LDA !MessageDone : BEQ +
	INC !BattleState
+	RTS
	
WriteText:
	LDA [!Message]
	CMP #$FF : BNE + : JMP .MessageDone
+	CMP #$FE : BNE + : JMP .NextMessage
+	CMP #$FD : BNE + : JMP .NewLine
+	CMP #$FC : BNE + : JMP .WriteName
+	CMP #$FA : BNE + : JMP .EndText
.Print
+	LDA #$01 : TSB !DMAFlag
	REP #$20
	LDA !TextPos : STA !Dest1
	LDA !Message : STA !Tilemap1
	LDY.b !Message+2 : STY !Tilemap1+2
	LDA #$0001 : STA !Size1
	; We're not printing a name, so clear this.
	STZ !ScratchRAM1
	SEP #$20
	
	LDA $15 : BIT #$80 : BNE .PrintTextFast
	LDA !TextSpeed
	CMP #$01 : BEQ .PrintTextMed
	CMP #$02 : BEQ .PrintTextSlow
.PrintTextFast
	REP #$20
	INC !Message : INC !Message
	INC !TextPos
	SEP #$20
	RTS
.PrintTextMed
	LDA $13 : AND #$01 : BNE +
	JSR .PrintTextFast
+	RTS
.PrintTextSlow
	LDA $13 : AND #$03 : BNE +
	JSR .PrintTextFast
+	RTS
.NewLine
	REP #$20
	LDA !TextPosInit : CLC : ADC #$0040 : STA !TextPos
	INC !Message
	SEP #$20
	JMP WriteText
.NextMessage
	LDA $16 : ORA $18 : BIT #$80 : BEQ .ShowArrow
	LDA #$23 : STA $1DFC
	JSR .ClearText
	LDA !TextPosInit : STA !TextPos
	INC !Message
	RTS
.ShowArrow
	LDA #$01 : TSB !DMAFlag
	REP #$20
	LDA #$535E : STA !Dest1
	LDA #NextMsgArrow : STA !Tilemap1
	LDY.b #NextMsgArrow>>16 : STY !Tilemap1+2
	LDA #$0001 : STA !Size1
	SEP #$20
	RTS
.MessageDone
	LDA $16 : ORA $18 : BIT #$80 : BEQ .ShowArrow
	LDA #$23 : STA $1DFC
.EndText
	LDA #$01 : STA !MessageDone
	RTS
.ClearText
	LDA #$01 : TSB !DMAFlag
	REP #$20
	LDA #$5240 : STA !Dest1
	LDA #TextBox : STA !Tilemap1
	LDA #$0280 : STA !Size1
	SEP #$20
	LDA #TextBox>>16 : STA !Tilemap1+2
	RTS
.WriteName
	; The second byte determines whether to read a team member's name (00), an enemy's name (01), or a move name (02).
	REP #$20
	LDA [!Message] : AND #$FF00 : XBA
	CMP #$0001 : BEQ .EnemyName
	CMP #$0002 : BEQ .MoveName
.PokeName
	LDA #!Poke1Name : CLC : ADC !ScratchRAM1 : STA $04
	LDY.b #!Poke1Name>>16 : STY $06
	SEP #$20
	BRA +
.MoveName
	LDX !CursorPos
	LDA !Poke1Move1,x : AND #$00FF : DEC : ASL
	REP #$10
	TAY
	LDA MoveTable,y : CLC : ADC !ScratchRAM1 : STA $04
	SEP #$10
	PHB : PLY : STY $06
	SEP #$20
	BRA +
.EnemyName
	REP #$10
	LDA !Enemy : AND #$00FF : DEC : ASL : TAY
	LDA PokeNamesTable,y : CLC : ADC !ScratchRAM1 : STA $04
	SEP #$30
	PHB : PLY : STY $06
+	LDA [$04] : STA !NameData
	LDA #$20 : STA !NameData+1
	REP #$20 : INC $04 : SEP #$20
	
	LDA #$01 : TSB !DMAFlag
	REP #$20
	LDA !TextPos : STA !Dest1
	LDA #!NameData : STA !Tilemap1
	LDY.b #!NameData>>16 : STY !Tilemap1+2
	LDA #$0001 : STA !Size1
	SEP #$20
	
	LDA $15 : BIT #$80 : BNE .PrintNameFast
	LDA !TextSpeed
	CMP #$01 : BEQ .PrintNameMed
	CMP #$02 : BEQ .PrintNameSlow
.PrintNameFast
	REP #$20
	INC !ScratchRAM1
	INC !TextPos
	SEP #$20
	LDA [$04] : CMP #$FF : BNE +
	REP #$20
	INC !Message : INC !Message
	SEP #$20
+	RTS
.PrintNameMed
	LDA $13 : AND #$01 : BNE +
	JSR .PrintNameFast
+	RTS
.PrintNameSlow
	LDA $13 : AND #$03 : BNE +
	JSR .PrintNameFast
+	RTS
;.NoPrint
;;	REP #$20 : INC !Message : SEP #$20
;	LDA #$02 : TSB !DMAFlag
;	REP #$20
;	LDA !TextPos : STA !Dest2
;	LDA !Message : STA !Tilemap2
;	LDY.b !Message+2 : STY !Tilemap2+2
;	SEP #$20
;	REP #$10
;	LDX #$0000
;-	LDA !Message,x : CMP #$FF : BEQ +
;	INX : BRA -
;+	REP #$20
;	TXA : STA !Size2
;	SEP #$30
;	LDA #$01 : STA !MessageDone
;	RTS

UploadBattleBox:
	LDA #$01 : STA !DMAFlag
	REP #$20
	LDA #$5240 : STA !Dest1
	LDA #BattleBox : STA !Tilemap1
	LDY.b #BattleBox>>16 : STY !Tilemap1+2
	LDA #$027F : STA !Size1
	SEP #$20
	INC !BattleState
	STZ !CursorPos
	RTS
	
BattleSelect:
MainMenu:
	LDX !CursorPos
	LDA .XPos,x : STA $0250
	LDA .YPos,x : STA $0251
	LDA #$0C : STA $0252
	LDA #$33 : STA $0253
	STZ $0434
	
	REP #$20
	LDA !EnemyHP : STA $00
	SEP #$20
	JSR HexDec
	
	LDA #$08 : STA $0254
	LDA #$08 : STA $0255
	LDA $02 : STA $0256
	LDA #$33 : STA $0257
	STZ $0435
	
	LDA #$10 : STA $0258
	LDA #$08 : STA $0259
	LDA $03 : STA $025A
	LDA #$33 : STA $025B
	STZ $0436
	
	REP #$20
	LDA !EnemyAttack : STA $00
	SEP #$20
	JSR HexDec
	
	LDA #$20 : STA $025C
	LDA #$08 : STA $025D
	LDA $02 : STA $025E
	LDA #$33 : STA $025F
	STZ $0436
	
	LDA #$28 : STA $0260
	LDA #$08 : STA $0261
	LDA $03 : STA $0262
	LDA #$33 : STA $0263
	STZ $0437
	
	REP #$20
	LDA !EnemyDefense : STA $00
	SEP #$20
	JSR HexDec
	
	LDA #$38 : STA $0264
	LDA #$08 : STA $0265
	LDA $02 : STA $0266
	LDA #$33 : STA $0267
	STZ $0438
	
	LDA #$40 : STA $0268
	LDA #$08 : STA $0269
	LDA $03 : STA $026A
	LDA #$33 : STA $026B
	STZ $0439
	
	REP #$20
	LDA !EnemySpeed : STA $00
	SEP #$20
	JSR HexDec
	
	LDA #$50 : STA $026C
	LDA #$08 : STA $026D
	LDA $02 : STA $026E
	LDA #$33 : STA $026F
	STZ $043A
	
	LDA #$58 : STA $0270
	LDA #$08 : STA $0271
	LDA $03 : STA $0272
	LDA #$33 : STA $0273
	STZ $043B
	
	REP #$20
	LDA !EnemySpecial : STA $00
	SEP #$20
	JSR HexDec
	
	LDA #$68 : STA $0274
	LDA #$08 : STA $0275
	LDA $02 : STA $0276
	LDA #$33 : STA $0277
	STZ $043C
	
	LDA #$70 : STA $0278
	LDA #$08 : STA $0279
	LDA $03 : STA $027A
	LDA #$33 : STA $027B
	STZ $043D

	LDA $18 : BIT #$80 : BEQ .NoPress
	LDA #$23 : STA $1DFC
	LDA !CursorPos
	BNE + : JMP .AttackMenu
+	CMP #$01 : BNE + : JMP .PkmnMenu
+	CMP #$02 : BNE + : JMP .ItemMenu
+	CMP #$03 : BNE .NoPress : JMP .Run
.NoPress
	LDA $16
	BIT #$01 : BNE .CursorRight
	BIT #$02 : BNE .CursorLeft
	BIT #$04 : BNE .CursorDown
	BIT #$08 : BNE .CursorUp
.NoMove
	RTS
.CursorRight
	LDA !CursorPos
	CMP #$01 : BEQ .NoMove
	CMP #$03 : BEQ .NoMove
	INC !CursorPos
	RTS
.CursorLeft
	LDA !CursorPos
	BEQ .NoMove
	CMP #$02 : BEQ .NoMove
	DEC !CursorPos
	RTS
.CursorDown
	LDA !CursorPos : CMP #$02 : BCS .NoMove
	INC !CursorPos : INC !CursorPos
	RTS
.CursorUp
	LDA !CursorPos : CMP #$02 : BCC .NoMove
	DEC !CursorPos : DEC !CursorPos
	RTS
.AttackMenu
	; Upload move box.
	LDA #$01 : TSB !DMAFlag
	REP #$20
	LDA #$5240 : STA !Dest1
	LDA #AttackBox : STA !Tilemap1
	LDY.b #AttackBox>>16 : STY !Tilemap1+2
	LDA #$027F : STA !Size1
	SEP #$20
	; Count the number of moves.
	LDX #$00
-	LDA !Poke1Move1,x : BEQ +
	INX : CPX #$04 : BEQ +
	BRA -
+	TXA : STA !NumberMoves
	CMP #$01 : BNE + : JMP .OneMove
+	CMP #$02 : BNE + : JMP .TwoMoves
+	CMP #$03 : BNE + : JMP .ThreeMoves
+
.FourMoves	
	; Store move name.
	REP #$30
	LDA !Poke1Move4 : AND #$00FF : DEC : ASL : TAY
	LDA MoveTable,y : STA $04
	SEP #$20
	LDX #$0000
-	LDA ($04) : CMP #$FF : BEQ + : STA !Move4,x
	INX : LDA #$20 : STA !Move4,x
	REP #$20 : INC $04 : SEP #$20 : INX
	BRA -
	
	; Fill in the rest of the tiles.
+	REP #$20
	STX $00
	LDA #$002A : SEC : SBC $00 : TAY
-	LDA #$2080 : STA !Move4,x : INX #2 : DEY #2 : BPL -
	LDA #$2086 : STA !Move4,x : INX #2
	LDA #$2086 : STA !Move4,x : INX #2
	LDY #$0004
-	LDA #$2080 : STA !Move4,x : INX #2 : DEY : BPL -
	LDA #$2086 : STA !Move4,x : INX #2
	LDY #$0003
-	LDA #$2080 : STA !Move4,x : INX #2 : DEY : BPL -
	LDA #$20A3 : STA !Move4,x : INX #2
	LDA #$20A8 : STA !Move4,x : INX #2
	LDA #$209F : STA !Move4,x : INX #2
	LDA #$2094 : STA !Move4,x : INX #2
	LDA #$20E3 : STA !Move4,x : INX #2
	
	; Fill in the Type.
	LDA !Poke1Move4 : AND #$00FF : DEC : ASL #3 : PHA : CLC : ADC #$0003 : TAY
	LDA Attack,y : AND #$00FF : STA $00
	LDA #$0006 : STA $02
	LDA #$0000
	JSR Multiply
	TAY
	
	LDA #$0005 : STA $00
-	SEP #$20
	LDA TypeNames,y : STA !Move4,x
	INX : LDA #$20 : STA !Move4,x
	INY : INX
	REP #$20 : DEC $00 : BPL -
	
	; Some more blank tiles.
	LDY #$0003
-	LDA #$2080 : STA !Move4,x : INX #2
	DEY : BPL -
	SEP #$20
	
	; Current PP.
	LDA !Poke1Move4PP : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move4,x : INX
	LDA #$20 : STA !Move4,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move4,x : INX
	LDA #$20 : STA !Move4,x : INX
	
	; Max PP.
	REP #$20
	LDA #$20E3 : STA !Move4,x : INX #2
	
	PLA : CLC : ADC #$0005 : TAY
	SEP #$20
	LDA Attack,y : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move4,x : INX
	LDA #$20 : STA !Move4,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move4,x : INX
	LDA #$20 : STA !Move4,x : INX
	
	; Upload.
	LDA #$10 : TSB !DMAFlag
	REP #$20
	LDA #$5329 : STA !Dest5
	TXA : STA !Size5
	SEP #$10
	LDA #!Move4 : STA !Tilemap5
	LDY.b #!Move4>>16 : STY !Tilemap5+2
	SEP #$20
	
.ThreeMoves
	; Store move name.
	REP #$30
	LDA !Poke1Move3 : AND #$00FF : DEC : ASL : TAY
	LDA MoveTable,y : STA $04
	SEP #$20
	LDX #$0000
-	LDA ($04) : CMP #$FF : BEQ + : STA !Move3,x
	INX : LDA #$20 : STA !Move3,x
	REP #$20 : INC $04 : SEP #$20 : INX
	BRA -
	
	; Fill in the rest of the tiles.
+	REP #$20
	STX $00
	LDA #$002A : SEC : SBC $00 : TAY
-	LDA #$2080 : STA !Move3,x : INX #2 : DEY #2 : BPL -
	LDA #$2086 : STA !Move3,x : INX #2
	LDA #$2086 : STA !Move3,x : INX #2
	LDY #$0004
-	LDA #$2080 : STA !Move3,x : INX #2 : DEY : BPL -
	LDA #$2086 : STA !Move3,x : INX #2
	LDY #$0003
-	LDA #$2080 : STA !Move3,x : INX #2 : DEY : BPL -
	LDA #$20A3 : STA !Move3,x : INX #2
	LDA #$20A8 : STA !Move3,x : INX #2
	LDA #$209F : STA !Move3,x : INX #2
	LDA #$2094 : STA !Move3,x : INX #2
	LDA #$20E3 : STA !Move3,x : INX #2
	
	; Fill in the Type.
	LDA !Poke1Move3 : AND #$00FF : DEC : ASL #3 : PHA : CLC : ADC #$0003 : TAY
	LDA Attack,y : AND #$00FF : STA $00
	LDA #$0006 : STA $02
	LDA #$0000
	JSR Multiply
	TAY
	
	LDA #$0005 : STA $00
-	SEP #$20
	LDA TypeNames,y : STA !Move3,x
	INX : LDA #$20 : STA !Move3,x
	INY : INX
	REP #$20 : DEC $00 : BPL -
	
	; Some more blank tiles.
	LDY #$0003
-	LDA #$2080 : STA !Move3,x : INX #2
	DEY : BPL -
	SEP #$20
	
	; Current PP.
	LDA !Poke1Move3PP : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move3,x : INX
	LDA #$20 : STA !Move3,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move3,x : INX
	LDA #$20 : STA !Move3,x : INX
	
	; Max PP.
	REP #$20
	LDA #$20E3 : STA !Move3,x : INX #2
	
	PLA : CLC : ADC #$0005 : TAY
	SEP #$20
	LDA Attack,y : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move3,x : INX
	LDA #$20 : STA !Move3,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move3,x : INX
	LDA #$20 : STA !Move3,x : INX
	
	; Upload.
	LDA #$08 : TSB !DMAFlag
	REP #$20
	LDA #$52E9 : STA !Dest4
	TXA : STA !Size4
	SEP #$10
	LDA #!Move3 : STA !Tilemap4
	LDY.b #!Move3>>16 : STY !Tilemap4+2
	SEP #$20
	
.TwoMoves
	; Store move name.
	REP #$30
	LDA !Poke1Move2 : AND #$00FF : DEC : ASL : TAY
	LDA MoveTable,y : STA $04
	SEP #$20
	LDX #$0000
-	LDA ($04) : CMP #$FF : BEQ + : STA !Move2,x
	INX : LDA #$20 : STA !Move2,x
	REP #$20 : INC $04 : SEP #$20 : INX
	BRA -
	
	; Fill in the rest of the tiles.
+	REP #$20
	STX $00
	LDA #$002A : SEC : SBC $00 : TAY
-	LDA #$2080 : STA !Move2,x : INX #2 : DEY #2 : BPL -
	LDA #$2086 : STA !Move2,x : INX #2
	LDA #$2086 : STA !Move2,x : INX #2
	LDY #$0004
-	LDA #$2080 : STA !Move2,x : INX #2 : DEY : BPL -
	LDA #$2086 : STA !Move2,x : INX #2
	LDY #$0003
-	LDA #$2080 : STA !Move2,x : INX #2 : DEY : BPL -
	LDA #$20A3 : STA !Move2,x : INX #2
	LDA #$20A8 : STA !Move2,x : INX #2
	LDA #$209F : STA !Move2,x : INX #2
	LDA #$2094 : STA !Move2,x : INX #2
	LDA #$20E3 : STA !Move2,x : INX #2
	
	; Fill in the Type.
	LDA !Poke1Move2 : AND #$00FF : DEC : ASL #3 : PHA : CLC : ADC #$0003 : TAY
	LDA Attack,y : AND #$00FF : STA $00
	LDA #$0006 : STA $02
	LDA #$0000
	JSR Multiply
	TAY
	
	LDA #$0005 : STA $00
-	SEP #$20
	LDA TypeNames,y : STA !Move2,x
	INX : LDA #$20 : STA !Move2,x
	INY : INX
	REP #$20 : DEC $00 : BPL -
	
	; Some more blank tiles.
	LDY #$0003
-	LDA #$2080 : STA !Move2,x : INX #2
	DEY : BPL -
	SEP #$20
	
	; Current PP.
	LDA !Poke1Move2PP : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move2,x : INX
	LDA #$20 : STA !Move2,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move2,x : INX
	LDA #$20 : STA !Move2,x : INX
	
	; Max PP.
	REP #$20
	LDA #$20E3 : STA !Move2,x : INX #2
	
	PLA : CLC : ADC #$0005 : TAY
	SEP #$20
	LDA Attack,y : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move2,x : INX
	LDA #$20 : STA !Move2,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move2,x : INX
	LDA #$20 : STA !Move2,x : INX
	
	; Upload.
	LDA #$04 : TSB !DMAFlag
	REP #$20
	LDA #$52A9 : STA !Dest3
	TXA : STA !Size3
	SEP #$10
	LDA #!Move2 : STA !Tilemap3
	LDY.b #!Move2>>16 : STY !Tilemap3+2
	SEP #$20

.OneMove
	; Store move name.
	REP #$30
	LDA !Poke1Move1 : AND #$00FF : DEC : ASL : TAY
	LDA MoveTable,y : STA $04
	SEP #$20
	LDX #$0000
-	LDA ($04) : CMP #$FF : BEQ + : STA !Move1,x
	INX : LDA #$20 : STA !Move1,x
	REP #$20 : INC $04 : SEP #$20 : INX
	BRA -
	
	; Fill in the rest of the tiles.
+	REP #$20
	STX $00
	LDA #$002A : SEC : SBC $00 : TAY
-	LDA #$2080 : STA !Move1,x : INX #2 : DEY #2 : BPL -
	LDA #$2086 : STA !Move1,x : INX #2
	LDA #$2086 : STA !Move1,x : INX #2
	LDY #$0004
-	LDA #$2080 : STA !Move1,x : INX #2 : DEY : BPL -
	LDA #$2086 : STA !Move1,x : INX #2
	LDY #$0003
-	LDA #$2080 : STA !Move1,x : INX #2 : DEY : BPL -
	LDA #$20A3 : STA !Move1,x : INX #2
	LDA #$20A8 : STA !Move1,x : INX #2
	LDA #$209F : STA !Move1,x : INX #2
	LDA #$2094 : STA !Move1,x : INX #2
	LDA #$20E3 : STA !Move1,x : INX #2
	
	; Fill in the Type.
	LDA !Poke1Move1 : AND #$00FF : DEC : ASL #3 : PHA : CLC : ADC #$0003 : TAY
	LDA Attack,y : AND #$00FF : STA $00
	LDA #$0006 : STA $02
	LDA #$0000
	JSR Multiply
	TAY
	
	LDA #$0005 : STA $00
-	SEP #$20
	LDA TypeNames,y : STA !Move1,x
	INX : LDA #$20 : STA !Move1,x
	INY : INX
	REP #$20 : DEC $00 : BPL -
	
	; Some more blank tiles.
	LDY #$0003
-	LDA #$2080 : STA !Move1,x : INX #2
	DEY : BPL -
	SEP #$20
	
	; Current PP.
	LDA !Poke1Move1PP : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move1,x : INX
	LDA #$20 : STA !Move1,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move1,x : INX
	LDA #$20 : STA !Move1,x : INX
	
	; Max PP.
	REP #$20
	LDA #$20E3 : STA !Move1,x : INX #2
	
	PLA : CLC : ADC #$0005 : TAY
	SEP #$20
	LDA Attack,y : STA $00
	LDA #$00 : STA $01
	JSR HexDec
	LDA $02 : CLC : ADC #$E6 : STA !Move1,x : INX
	LDA #$20 : STA !Move1,x : INX
	LDA $03 : CLC : ADC #$E6 : STA !Move1,x : INX
	LDA #$20 : STA !Move1,x : INX
	
	; Upload.
	LDA #$02 : TSB !DMAFlag
	REP #$20
	LDA #$5269 : STA !Dest2
	TXA : STA !Size2
	SEP #$10
	LDA #!Move1 : STA !Tilemap2
	LDY.b #!Move1>>16 : STY !Tilemap2+2
	SEP #$20
	
	; Move cursor.
	STZ !CursorPos
	LDA #$40 : STA $0250
	LDA #$97 : STA $0251
	; Decrease the move count so we can index it later.
	LDA !NumberMoves : SEC : SBC #$01 : STA !NumberMoves
	; We're done here.
	LDA #!AttackSelect : STA !BattleState
	RTS
.PkmnMenu
	LDA #$01 : TSB !DMAFlag
	REP #$20
	LDA #$5000 : STA !Dest1
	LDA #PkmnScreen : STA !Tilemap1
	LDY.b #PkmnScreen>>16 : STY !Tilemap1+2
	LDA #$0700 : STA !Size1
	SEP #$20
	STZ !CursorPos
	LDA #!PokeSelect : STA !BattleState
	RTS
.ItemMenu
	LDX #$3F
-	LDA !Enemy,x : STA !Poke1,x
	DEX : BPL -
	JSR UpdatePlayerHUD
	RTS
.Run
	; F = (A*32)/B + 30 * C
	; A = Speed of active Pokemon
	; B = Enemy's speed divided by 4
	; C = # escape attempts, reset with each attack
	; http://bulbapedia.bulbagarden.net/wiki/Escape#Generation_I_and_II
	LDA !RunAttempts : CMP #$FF : BEQ +
	INC !RunAttempts
+	REP #$20 
	LDA !Poke1Speed : ASL #5 : STA $4204
	LDA !EnemySpeed : LSR #2 : TAX : STX $4206
	; Calculate 30 * C
	LDX !RunAttempts : STX $4202
	LDX #$1E : STX $4203
	JSR Cycles
	; Calculate F
	LDA $4216 : CLC : ADC $4214 : CMP #$0100 : BCS .RunSuccessful
	STA $00
	SEP #$20
	LDA #$FF : JSR Random : CMP $00 : BCC .RunSuccessful
.RunFailed
	JSR WriteText_ClearText
	LDX #$00 : LDY #$00
	%StoreMessage(CantEscape)
	%WriteMessage()
	LDA #!MessageWrite : STA !BattleState
	RTS
.RunSuccessful	
	SEP #$20
	JSR WriteText_ClearText
	LDX #$00 : LDY #$00
	%StoreMessage(GotAway)
	%WriteMessage()
	LDA #!Run : STA !BattleState
	RTS
	
	.XPos
		db $80,$C8,$80,$C8
	.YPos
		db $A7,$A7,$BF,$BF
	
AttackSelect:
	LDX !CursorPos
	LDA #$40 : STA $0250
	LDA .YPos,x : STA $0251
	LDA #$0C : STA $0252
	LDA #$33 : STA $0253
	STZ $0434
	
	LDA $16
	BIT #$80 : BNE .Cancel
	BIT #$04 : BNE .CursorDown
	BIT #$08 : BNE .CursorUp
	
	LDA $18
	BIT #$80 : BNE .Attack
	RTS
.Cancel
	LDA #!UploadBattleBox : STA !BattleState
	RTS
.CursorDown
	LDA !CursorPos : CMP !NumberMoves : BEQ .ResetCursor
	INC !CursorPos
	RTS
.ResetCursor
	STZ !CursorPos
	RTS
.CursorUp
	LDA !CursorPos : BEQ .MaxCursor
	DEC !CursorPos
	RTS
.MaxCursor
	LDA !NumberMoves : STA !CursorPos
	RTS
	
	.YPos
		db $97,$A7,$B7,$C7
		
.Attack
	LDA #$23 : STA $1DFC
	
	JSR WriteText_ClearText
	LDX #$00 : LDY #$00
	%StoreMessage(PokeUsedMove)
	%WriteMessage()
	LDA #!DisplayAttack : STA !BattleState
	RTS
	
DisplayAttack:
	JSR WriteText
	LDA !MessageDone : BNE .DoDamage
	RTS
.DoDamage	
	LDX !CursorPos
	LDA !Poke1Move1PP,x : DEC : STA !Poke1Move1PP,x
	STZ !RunAttempts
	STZ !ModifierText
	; Damage = [([2 * Level]/5 + 2) * Base * (Attack / Defense)]/50 + 2 * Modifier
	; http://www.smogon.com/bw/articles/bw_complete_damage_formula
	; http://bulbapedia.bulbagarden.net/wiki/Damage#Damage_formula
	
	; Check if critical hit
	REP #$30
	LDA !Poke1 : AND #$00FF : DEC : ASL #5 : CLC : ADC #$0004 : TAX
	SEP #$20
	LDA BaseStats,x : LSR : INC : STA $04
	SEP #$10
	LDA #$FF : JSR Random : CMP $04 : BCS .NoCrit
	LDA #$01 : STA !ModifierText
	REP #$20
	LDA !Poke1Level : AND #$00FF : ASL #2 : STA $4204
	BRA +
.NoCrit
	REP #$20
	LDA !Poke1Level : AND #$00FF : ASL : STA $4204
+	LDX #$05 : STX $4206
	JSR Cycles
	LDA $4214 : INC #2 : STA $00
	LDX !CursorPos
	LDA !Poke1Move1,x : AND #$00FF : DEC : ASL #3 : CLC : ADC #$0002
	REP #$10
	TAX
	LDA Attack,x : AND #$00FF : STA $02
	SEP #$10
	LDA #$0000
	JSR Multiply
	STA $00
	LDA !EnemyDefense : CMP #$0100 : BCC + : JMP .Scale
+	LDA !Poke1Attack : STA $4204
	LDA !EnemyDefense : TAY : STY $4206
	JSR Cycles
.NoScale
	LDA $4214 : STA $02
	LDA #$0000
	JSR Multiply
	STA $4204
	LDX #$32 : STX $4206
	JSR Cycles
	LDA $4214 : INC #2 : STA $00
.Modifier
	; Modifier = STAB * Type * Critical * other * random(0.85,1)
	; Check for STAB
	LDX !CursorPos
	LDA !Poke1Move1,x : AND #$00FF : DEC : ASL #3 : CLC : ADC #$0003
	REP #$10
	TAX : PHX
	SEP #$20
	LDA Attack,x
	SEP #$10
	CMP !Poke1Type1 : BEQ .STAB
	CMP !Poke1Type2 : BEQ .STAB
	BRA .NoSTAB
.STAB
	; Multiply damage by 1.5 if STAB.
	REP #$20
	LDA #$0096 : STA $02
	LDA #$0000
	JSR Multiply
	STA $4204
	LDX #$64 : STX $4206
	JSR Cycles
	LDA $4214 : STA $00
.NoSTAB
	SEP #$20
	; Check for type advantage
	REP #$10
	LDY #$0000
	PLX
.CheckTypeLoop
	LDA TypeEffects,y
	CMP #$FF : BEQ .Deviation
	CMP Attack,x : BEQ +
	INY
-	INY
	INY
	BRA .CheckTypeLoop
+	INY
	LDA TypeEffects,y
	CMP !EnemyType1 : BEQ .TypeMatchup
	CMP !EnemyType2 : BNE -
.TypeMatchup
	INY
	LDA TypeEffects,y
	CMP #$05 : BEQ .NotEffective
	CMP #$20 : BEQ .SuperEffective
.NoDamage
	LDA #$02 : TSB !ModifierText
	REP #$20
	STZ $00
	BRA .Deviation
.NotEffective
	LDA #$04 : TSB !ModifierText
	REP #$20
	LDA $00 : LSR : STA $00
	BRA .Deviation
.SuperEffective
	LDA #$08 : TSB !ModifierText
	REP #$20
	LDA $00 : ASL : STA $00

.Deviation
	; random
	SEP #$30
	LDA #$0F
	JSR Random
	CLC : ADC #$55
	REP #$20
	AND #$00FF : STA $02
	LDA #$0000
	JSR Multiply
	STA $4204
	LDX #$64 : STX $4206
	JSR Cycles
	LDA $4214 : STA $00
	
.ApplyDamage
	REP #$20
	LDA $00 : STA !ScratchRAM2
	LDA !EnemyHP : SEC : SBC !ScratchRAM2 : STA !ScratchRAM3
	SEP #$20
	INC !BattleState
	RTS
	
.Scale
	LDA !Poke1Attack : LSR #2 : STA $4204
	LDA !EnemyDefense : LSR #2 : TAY : STY $4206
	JSR Cycles
	JMP .NoScale
	
DecreaseHP:
	LDA $13 : AND #$03 : BNE .Return
	REP #$20
	LDA !EnemyHP : CMP !ScratchRAM3 : BEQ .NextTurn
	LDA !EnemyHP : BEQ .NextTurn : SEC : SBC #$0001 : STA !EnemyHP
	SEP #$20
	JSR UpdatePlayerHUD
	JSR UpdateEnemyHUD
.Return
	RTS
	
.NextTurn
	SEP #$20
	JSR UpdatePlayerHUD
	JSR UpdateEnemyHUD
	LDX #$00 : LDY #$00
	LDA !ModifierText
	BIT #$01 : BNE .CriticalHitMessage
	BIT #$02 : BEQ + : JMP .NoEffectMessage
+	BIT #$04 : BEQ + : JMP .LittleEffectMessage
+	BIT #$08 : BEQ + : JMP .HighEffectMessage
+	LDA #!UploadBattleBox : STA !BattleState
	RTS
	
.CriticalHitMessage
	JSR WriteText_ClearText
	%StoreMessage(CriticalHit)
	LDA !ModifierText
	BIT #$02 : BEQ +
	LDA #$FE : STA !MessageData,x : INX
	JMP .NoEffectMessage
+	BIT #$04 : BEQ +
	LDA #$FE : STA !MessageData,x : INX
	JMP .LittleEffectMessage
+	BIT #$08 : BEQ +
	LDA #$FE : STA !MessageData,x : INX
	JMP .HighEffectMessage
+	LDA #$FF : STA !MessageData,x
	%WriteMessage()
	LDA #!MessageWrite : STA !BattleState
	RTS

.NoEffectMessage
	JSR WriteText_ClearText
	LDY #$00
	%StoreMessage(NoEffect)
	LDA #$FF : STA !MessageData,x
	%WriteMessage()
	LDA #!MessageWrite : STA !BattleState
	RTS
	
.LittleEffectMessage
	JSR WriteText_ClearText
	LDY #$00
	%StoreMessage(NotVeryEffective)
	LDA #$FF : STA !MessageData,x
	%WriteMessage()
	LDA #!MessageWrite : STA !BattleState
	RTS
	
.HighEffectMessage
	JSR WriteText_ClearText
	LDY #$00
	%StoreMessage(SuperEffective)
	LDA #$FF : STA !MessageData,x
	%WriteMessage()
	LDA #!MessageWrite : STA !BattleState
	RTS
	
	
	; TODO: Rewrite DMA stuff. http://www.smwcentral.net/?p=viewthread&t=74275
PokeSelect:
	LDX !CursorPos
	LDA #$20 : STA $0250
	LDA .YPos,x : STA $0251
	LDA #$0C : STA $0252
	LDA #$33 : STA $0253
	STZ $0434
	
	LDA $16
	BIT #$80 : BNE .Cancel
	BIT #$04 : BNE .CursorDown
	BIT #$08 : BNE .CursorUp
	RTS
.Cancel
	LDA #$01 : STA !DMAFlag
	REP #$20
	LDA #$5000 : STA !Dest1
	LDA #Empty : STA !Tilemap1
	LDY.b #Empty>>16 : STY !Tilemap1+2
	LDA #$0700 : STA !Size1
	SEP #$20
	
	LDA #!DispWildPoke : STA !BattleState
	LDA #$01 : STA !MessageDone
	RTS
.CursorDown
	LDA !CursorPos
	CMP #$05 : BEQ .ResetCursor
	INC !CursorPos
	RTS
.ResetCursor
	STZ !CursorPos
	RTS
.CursorUp
	LDA !CursorPos : BEQ .MaxCursor
	DEC !CursorPos
	RTS
.MaxCursor
	LDA #$05 : STA !CursorPos
	RTS

	.YPos
		db $0F,$27,$3F,$57,$6F,$87
	
ItemSelect:
	RTS
	
Run:
	JSR WriteText
	LDA !MessageDone : BEQ .Return
	
	LDA #$01 : STA !DMAFlag
	REP #$20
	LDA #$5000 : STA !Dest1
	LDA #Empty : STA !Tilemap1
	LDY.b #Empty>>16 : STY !Tilemap1+2
	LDA #$0700 : STA !Size1
	
	LDX #$01 : STX !PaletteFlag
	LDA #$56B5 : STA $070D
	LDA #$318C : STA $070F
	LDA #$0000 : STA $0711
	SEP #$20
	LDA #!Overworld : STA !BattleState
	LDA !Facing : EOR #$01 : INC : STA $15
.Return
	RTS
	
WildPoke:
	db "Wild ",$FC,$01,$FD
	db "appeared!",$FF
GotAway:
	db "Got away safely!",$FF
CantEscape:
	db "Can",$CE," escape!",$FF
CriticalHit:
	db "Critical hit!",$FB
NoEffect:
	db "It doesn",$CE," affect",$FD
	db $FC,$01,"!",$FB
NotVeryEffective:
	db "It",$CD," not very effective...",$FB
SuperEffective:
	db "It",$CD," super effective!",$FB
PokeUsedMove:
	db $FC,$00," used",$FD
	db $FC,$02,"!",$FA
EnemyUsedMove:
	db "Enemy ",$FC,$01," used",$FD
	db $FC,$02,"!",$FA
;ChoosePoke:
;	db $F9,"Choose a POK",$CA,"MON.",$FF
TypeNames:
	db "NORMAL"
	db "FIGHT "
	db "FLYING"
	db "POISON"
	db "GROUND"
	db "ROCK  "
	db "XXXXXX"
	db "BUG   "
	db "GHOST "
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "XXXXXX"
	db "FIRE  "
	db "WATER "
	db "GRASS "
	db "ELECTR"
	db "PSYCHC"
	db "ICE   "
	db "DRAGON"
SpriteTilemap:
	db $00,$21,$01,$21,$02,$21,$03,$21,$04,$21,$05,$21,$06,$21,$07,$21
	db $08,$21,$09,$21,$0A,$21,$0B,$21,$0C,$21,$0D,$21,$0E,$21,$0F,$21
	db $10,$21,$11,$21,$12,$21,$13,$21,$14,$21,$15,$21,$16,$21,$17,$21
	db $18,$21,$19,$21,$1A,$21,$1B,$21,$1C,$21,$1D,$21,$1E,$21,$1F,$21
	db $20,$21,$21,$21,$22,$21,$23,$21,$24,$21,$25,$21,$26,$21,$27,$21
	db $28,$21,$29,$21,$2A,$21,$2B,$21,$2C,$21,$2D,$21,$2E,$21,$2F,$21
	db $30,$21,$31,$21,$32,$21,$33,$21,$34,$21,$35,$21,$36,$21,$37,$21
	db $38,$21,$39,$21,$3A,$21,$3B,$21,$3C,$21,$3D,$21,$3E,$21,$3F,$21
	db $40,$21,$41,$21,$42,$21,$43,$21,$44,$21,$45,$21,$46,$21,$47,$21
	db $48,$21,$49,$21,$4A,$21,$4B,$21,$4C,$21,$4D,$21,$4E,$21,$4F,$21
	db $50,$21,$51,$21,$52,$21,$53,$21,$54,$21,$55,$21,$56,$21,$57,$21
	db $58,$21,$59,$21,$5A,$21,$5B,$21,$5C,$21,$5D,$21,$5E,$21,$5F,$21
	db $60,$21,$61,$21
BackSpriteTilemap:
	db $80,$21,$81,$21,$82,$21,$83,$21,$84,$21,$85,$21,$86,$21,$87,$21
	db $88,$21,$89,$21,$8A,$21,$8B,$21,$8C,$21,$8D,$21,$8E,$21,$8F,$21
	db $90,$21,$91,$21,$92,$21,$93,$21,$94,$21,$95,$21,$96,$21,$97,$21
	db $98,$21,$99,$21,$9A,$21,$9B,$21,$9C,$21,$9D,$21,$9E,$21,$9F,$21
	db $A0,$21,$A1,$21,$A2,$21,$A3,$21,$A4,$21,$A5,$21,$A6,$21,$A7,$21
	db $A8,$21,$A9,$21,$AA,$21,$AB,$21,$AC,$21,$AD,$21,$AE,$21,$AF,$21
	db $B0,$21,$B1,$21,$B2,$21,$B3,$21,$B4,$21,$B5,$21,$B6,$21,$B7,$21
	db $B8,$21,$B9,$21,$BA,$21,$BB,$21,$BC,$21,$BD,$21,$BE,$21,$BF,$21
	db $C0,$21,$C1,$21,$C2,$21,$C3,$21,$C4,$21,$C5,$21,$C6,$21,$C7,$21
	db $C8,$21,$C9,$21,$CA,$21,$CB,$21,$CC,$21,$CD,$21,$CE,$21,$CF,$21
	db $D0,$21,$D1,$21,$D2,$21,$D3,$21,$D4,$21,$D5,$21,$D6,$21,$D7,$21
	db $D8,$21,$D9,$21,$DA,$21,$DB,$21,$DC,$21,$DD,$21,$DE,$21,$DF,$21
	db $E0,$21,$E1,$21
NextMsgArrow:
	db $DE,$20
BaseStats:
	incsrc ../../Patches/PokemonBaseStatData.asm
	incsrc ../../Patches/PokeNames.asm
	incsrc ../../Patches/PokemonLearnsetData.asm
Attack:
	incsrc ../../Patches/PokemonAttackData.asm
	incsrc ../../Patches/MoveNames.asm
TypeEffects:
	incsrc ../../Patches/TypeEffects.asm
	
incbin ../../Tilemaps/Blank.bin -> Blank
incbin ../../Tilemaps/Empty.bin -> Empty
incbin ../../Tilemaps/TextBox.bin -> TextBox
incbin ../../Tilemaps/BattleBox.bin -> BattleBox
incbin ../../Tilemaps/AttackBox.bin -> AttackBox
incbin ../../Tilemaps/BlankAttack.bin -> BlankAttack
incbin ../../Tilemaps/Pokemon.bin -> Pokemon
incbin ../../Tilemaps/PokemonFront.bin -> FrontSprite
incbin ../../Tilemaps/PokemonBack.bin -> BackSprite
incbin ../../Tilemaps/PkmnSelect.bin -> PkmnScreen
	
level106:
	RTS
level107:
	RTS
level108:
	RTS
level109:
	RTS
level10A:
	RTS
level10B:
	RTS
level10C:
	RTS
level10D:
	RTS
level10E:
	RTS
level10F:
	RTS
level110:
	RTS
level111:
	RTS
level112:
	RTS
level113:
	RTS
level114:
	RTS
level115:
	RTS
level116:
	RTS
level117:
	RTS
level118:
	RTS
level119:
	RTS
level11A:
	RTS
level11B:
	RTS
level11C:
	RTS
level11D:
	RTS
level11E:
	RTS
level11F:
	RTS
level120:
	RTS
level121:
	RTS
level122:
	RTS
level123:
	RTS
level124:
	RTS
level125:
	RTS
level126:
	RTS
level127:
	RTS
level128:
	RTS
level129:
	RTS
level12A:
	RTS
level12B:
	RTS
level12C:
	RTS
level12D:
	RTS
level12E:
	RTS
level12F:
	RTS
level130:
	RTS
level131:
	RTS
level132:
	RTS
level133:
	RTS
level134:
	RTS
level135:
	RTS
level136:
	RTS
level137:
	RTS
level138:
	RTS
level139:
	RTS
level13A:
	RTS
level13B:
	RTS
level13C:
	RTS
level13D:
	RTS
level13E:
	RTS
level13F:
	RTS
level140:
	RTS
level141:
	RTS
level142:
	RTS
level143:
	RTS
level144:
	RTS
level145:
	RTS
level146:
	RTS
level147:
	RTS
level148:
	RTS
level149:
	RTS
level14A:
	RTS
level14B:
	RTS
level14C:
	RTS
level14D:
	RTS
level14E:
	RTS
level14F:
	RTS
level150:
	RTS
level151:
	RTS
level152:
	RTS
level153:
	RTS
level154:
	RTS
level155:
	RTS
level156:
	RTS
level157:
	RTS
level158:
	RTS
level159:
	RTS
level15A:
	RTS
level15B:
	RTS
level15C:
	RTS
level15D:
	RTS
level15E:
	RTS
level15F:
	RTS
level160:
	RTS
level161:
	RTS
level162:
	RTS
level163:
	RTS
level164:
	RTS
level165:
	RTS
level166:
	RTS
level167:
	RTS
level168:
	RTS
level169:
	RTS
level16A:
	RTS
level16B:
	RTS
level16C:
	RTS
level16D:
	RTS
level16E:
	RTS
level16F:
	RTS
level170:
	RTS
level171:
	RTS
level172:
	RTS
level173:
	RTS
level174:
	RTS
level175:
	RTS
level176:
	RTS
level177:
	RTS
level178:
	RTS
level179:
	RTS
level17A:
	RTS
level17B:
	RTS
level17C:
	RTS
level17D:
	RTS
level17E:
	RTS
level17F:
	RTS
level180:
	RTS
level181:
	RTS
level182:
	RTS
level183:
	RTS
level184:
	RTS
level185:
	RTS
level186:
	RTS
level187:
	RTS
level188:
	RTS
level189:
	RTS
level18A:
	RTS
level18B:
	RTS
level18C:
	RTS
level18D:
	RTS
level18E:
	RTS
level18F:
	RTS
level190:
	RTS
level191:
	RTS
level192:
	RTS
level193:
	RTS
level194:
	RTS
level195:
	RTS
level196:
	RTS
level197:
	RTS
level198:
	RTS
level199:
	RTS
level19A:
	RTS
level19B:
	RTS
level19C:
	RTS
level19D:
	RTS
level19E:
	RTS
level19F:
	RTS
level1A0:
	RTS
level1A1:
	RTS
level1A2:
	RTS
level1A3:
	RTS
level1A4:
	RTS
level1A5:
	RTS
level1A6:
	RTS
level1A7:
	RTS
level1A8:
	RTS
level1A9:
	RTS
level1AA:
	RTS
level1AB:
	RTS
level1AC:
	RTS
level1AD:
	RTS
level1AE:
	RTS
level1AF:
	RTS
level1B0:
	RTS
level1B1:
	RTS
level1B2:
	RTS
level1B3:
	RTS
level1B4:
	RTS
level1B5:
	RTS
level1B6:
	RTS
level1B7:
	RTS
level1B8:
	RTS
level1B9:
	RTS
level1BA:
	RTS
level1BB:
	RTS
level1BC:
	RTS
level1BD:
	RTS
level1BE:
	RTS
level1BF:
	RTS
level1C0:
	RTS
level1C1:
	RTS
level1C2:
	RTS
level1C3:
	RTS
level1C4:
	RTS
level1C5:
	RTS
level1C6:
	RTS
level1C7:
	RTS
level1C8:
	RTS
level1C9:
	RTS
level1CA:
	RTS
level1CB:
	RTS
level1CC:
	RTS
level1CD:
	RTS
level1CE:
	RTS
level1CF:
	RTS
level1D0:
	RTS
level1D1:
	RTS
level1D2:
	RTS
level1D3:
	RTS
level1D4:
	RTS
level1D5:
	RTS
level1D6:
	RTS
level1D7:
	RTS
level1D8:
	RTS
level1D9:
	RTS
level1DA:
	RTS
level1DB:
	RTS
level1DC:
	RTS
level1DD:
	RTS
level1DE:
	RTS
level1DF:
	RTS
level1E0:
	RTS
level1E1:
	RTS
level1E2:
	RTS
level1E3:
	RTS
level1E4:
	RTS
level1E5:
	RTS
level1E6:
	RTS
level1E7:
	RTS
level1E8:
	RTS
level1E9:
	RTS
level1EA:
	RTS
level1EB:
	RTS
level1EC:
	RTS
level1ED:
	RTS
level1EE:
	RTS
level1EF:
	RTS
level1F0:
	RTS
level1F1:
	RTS
level1F2:
	RTS
level1F3:
	RTS
level1F4:
	RTS
level1F5:
	RTS
level1F6:
	RTS
level1F7:
	RTS
level1F8:
	RTS
level1F9:
	RTS
level1FA:
	RTS
level1FB:
	RTS
level1FC:
	RTS
level1FD:
	RTS
level1FE:
	RTS
level1FF:
	RTS
